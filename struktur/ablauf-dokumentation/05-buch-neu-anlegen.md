# 05 - Buch neu anlegen

> **Szenario:** Ein eingeloggter Admin erstellt ein neues Buch Ã¼ber das Formular.

---

## ğŸ”„ Ablauf-Diagramm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. VORAUSSETZUNG: User ist eingeloggt als Admin                                      â”‚
â”‚                                                                                      â”‚
â”‚    Der User hat sich Ã¼ber Login angemeldet (siehe 04-login-authentifizierung.md)     â”‚
â”‚    â†’ JWT Token ist im localStorage gespeichert                                       â”‚
â”‚    â†’ "Neues Buch" Link ist im Header sichtbar                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. NAVIGATION: Klick auf "Neues Buch anlegen"                                        â”‚
â”‚                                                                                      â”‚
â”‚    app.component.ts:                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ <a routerLink="/buch/neu" *ngIf="isLoggedIn$ | async">                       â”‚  â”‚
â”‚    â”‚     â• Neues Buch anlegen                                                    â”‚  â”‚
â”‚    â”‚ </a>                                                                         â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. AUTH GUARD: PrÃ¼fung ob User eingeloggt ist                                        â”‚
â”‚                                                                                      â”‚
â”‚    main.ts:                                                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ {                                                                            â”‚  â”‚
â”‚    â”‚     path: 'buch/neu',                                                        â”‚  â”‚
â”‚    â”‚     component: NewComponent,                                                 â”‚  â”‚
â”‚    â”‚     canActivate: [authGuard]  // â—„â”€â”€ Guard wird ausgefÃ¼hrt                  â”‚  â”‚
â”‚    â”‚ }                                                                            â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                      â”‚
â”‚    auth.guard.ts:                                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ if (authService.isLoggedIn()) {                                              â”‚  â”‚
â”‚    â”‚     return true;  // âœ“ User ist eingeloggt â†’ Route freigeben                 â”‚  â”‚
â”‚    â”‚ }                                                                            â”‚  â”‚
â”‚    â”‚ // Sonst: Redirect zu /login                                                 â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. NEW-COMPONENT: Formular initialisieren                                            â”‚
â”‚                                                                                      â”‚
â”‚    new.component.ts:                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ ngOnInit(): void {                                                           â”‚  â”‚
â”‚    â”‚     this.form = this.fb.group({                                              â”‚  â”‚
â”‚    â”‚         titel: ['', [Validators.required, Validators.maxLength(40)]],        â”‚  â”‚
â”‚    â”‚         untertitel: ['', Validators.maxLength(40)],                          â”‚  â”‚
â”‚    â”‚         rating: [0, [Validators.required, Validators.min(0), max(5)]],       â”‚  â”‚
â”‚    â”‚         art: [''],                                                           â”‚  â”‚
â”‚    â”‚         preis: [null, [Validators.required, Validators.min(0)]],             â”‚  â”‚
â”‚    â”‚         rabatt: [0, [Validators.min(0), Validators.max(1)]],                 â”‚  â”‚
â”‚    â”‚         lieferbar: [true],                                                   â”‚  â”‚
â”‚    â”‚         datum: [''],                                                         â”‚  â”‚
â”‚    â”‚         homepage: [''],                                                      â”‚  â”‚
â”‚    â”‚         schlagwoerter: [''],                                                 â”‚  â”‚
â”‚    â”‚         beschreibung: [''],                                                  â”‚  â”‚
â”‚    â”‚         autor: [''],                                                         â”‚  â”‚
â”‚    â”‚         autorBiographie: ['']                                                â”‚  â”‚
â”‚    â”‚     });                                                                      â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     this.regenerateIsbn();  // ISBN automatisch generieren                   â”‚  â”‚
â”‚    â”‚ }                                                                            â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ISBN GENERIERUNG: Automatisch gÃ¼ltige ISBN-13 erstellen                           â”‚
â”‚                                                                                      â”‚
â”‚    new.component.ts:                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ regenerateIsbn(): void {                                                     â”‚  â”‚
â”‚    â”‚     // ISBN-13 Format: 978-X-XXXXX-XXX-P                                     â”‚  â”‚
â”‚    â”‚     const prefix = '978';                                                    â”‚  â”‚
â”‚    â”‚     const group = '3';           // Deutschsprachig                          â”‚  â”‚
â”‚    â”‚     const publisher = this.randomDigits(5);                                  â”‚  â”‚
â”‚    â”‚     const title = this.randomDigits(3);                                      â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     // PrÃ¼fziffer berechnen (ISBN-13 Algorithmus)                            â”‚  â”‚
â”‚    â”‚     const digits = `${prefix}${group}${publisher}${title}`;                  â”‚  â”‚
â”‚    â”‚     let sum = 0;                                                             â”‚  â”‚
â”‚    â”‚     for (let i = 0; i < 12; i++) {                                           â”‚  â”‚
â”‚    â”‚         sum += Number(digits[i]) * (i % 2 === 0 ? 1 : 3);                    â”‚  â”‚
â”‚    â”‚     }                                                                        â”‚  â”‚
â”‚    â”‚     const checkDigit = (10 - (sum % 10)) % 10;                               â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     this.generatedIsbn = `${prefix}-${group}-${publisher}-${title}-${checkDigit}`;  â”‚
â”‚    â”‚ }                                                                            â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                      â”‚
â”‚    Beispiel: 978-3-12345-678-9                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. NUTZER: Formular ausfÃ¼llen                                                        â”‚
â”‚                                                                                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚  â”‚
â”‚    â”‚  â•‘                     Neues Buch anlegen                                â•‘  â”‚  â”‚
â”‚    â”‚  â•‘                                                                       â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  Titel *:        [Angular fÃ¼r Profis_______________]                  â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  Untertitel:     [Ein Praxishandbuch________________]                  â•‘  â”‚  â”‚
â”‚    â”‚  â•‘                                                                       â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  ISBN-13:        978-3-12345-678-9  [ğŸ”„ Neu]                          â•‘  â”‚  â”‚
â”‚    â”‚  â•‘                                                                       â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  Rating (0-5):   [4___]                                               â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  Buchart:        [HARDCOVER â–¼]                                        â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  Preis (â‚¬) *:    [49.99___]                                           â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  Rabatt (0-1):   [0.1_____]  (= 10%)                                  â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  Lieferbar:      [âœ“]                                                  â•‘  â”‚  â”‚
â”‚    â”‚  â•‘                                                                       â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  SchlagwÃ¶rter:   [Angular, TypeScript, Frontend]                      â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  Beschreibung:   [Ein umfassendes Handbuch fÃ¼r...]                    â•‘  â”‚  â”‚
â”‚    â”‚  â•‘  Autor:          [Max Mustermann]                                     â•‘  â”‚  â”‚
â”‚    â”‚  â•‘                                                                       â•‘  â”‚  â”‚
â”‚    â”‚  â•‘              [        Buch anlegen        ]                           â•‘  â”‚  â”‚
â”‚    â”‚  â•‘                                                                       â•‘  â”‚  â”‚
â”‚    â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. FORM SUBMIT: onSubmit() wird aufgerufen                                           â”‚
â”‚                                                                                      â”‚
â”‚    new.component.ts:                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ onSubmit(): void {                                                           â”‚  â”‚
â”‚    â”‚     this.form.markAllAsTouched();                                            â”‚  â”‚
â”‚    â”‚     if (this.form.invalid) return;                                           â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     this.isSubmitting = true;                                                â”‚  â”‚
â”‚    â”‚     this.submitError = null;                                                 â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     const payload: CreateBuchPayload = {                                     â”‚  â”‚
â”‚    â”‚         isbn: this.generatedIsbn,                                            â”‚  â”‚
â”‚    â”‚         rating: this.form.value.rating,                                      â”‚  â”‚
â”‚    â”‚         art: this.form.value.art || undefined,                               â”‚  â”‚
â”‚    â”‚         preis: this.form.value.preis,                                        â”‚  â”‚
â”‚    â”‚         rabatt: this.form.value.rabatt || undefined,                         â”‚  â”‚
â”‚    â”‚         lieferbar: this.form.value.lieferbar,                                â”‚  â”‚
â”‚    â”‚         datum: this.form.value.datum || undefined,                           â”‚  â”‚
â”‚    â”‚         schlagwoerter: this.parseSchlagwoerter(),                            â”‚  â”‚
â”‚    â”‚         beschreibung: this.form.value.beschreibung || undefined,             â”‚  â”‚
â”‚    â”‚         autor: this.form.value.autor || undefined,                           â”‚  â”‚
â”‚    â”‚         titel: {                                                             â”‚  â”‚
â”‚    â”‚             titel: this.form.value.titel,                                    â”‚  â”‚
â”‚    â”‚             untertitel: this.form.value.untertitel || undefined              â”‚  â”‚
â”‚    â”‚         }                                                                    â”‚  â”‚
â”‚    â”‚     };                                                                       â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     this.api.create(payload).subscribe({...});                               â”‚  â”‚
â”‚    â”‚ }                                                                            â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. BUCH-API-SERVICE: GraphQL Mutation aufrufen                                       â”‚
â”‚                                                                                      â”‚
â”‚    buch-api.service.ts:                                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ create(buch: CreateBuchPayload): Observable<void> {                          â”‚  â”‚
â”‚    â”‚     const input = {                                                          â”‚  â”‚
â”‚    â”‚         isbn: buch.isbn.replaceAll(/[-\s]/g, ''),  // Format: 9783123456789  â”‚  â”‚
â”‚    â”‚         rating: buch.rating,                                                 â”‚  â”‚
â”‚    â”‚         preis: buch.preis,                                                   â”‚  â”‚
â”‚    â”‚         titel: {                                                             â”‚  â”‚
â”‚    â”‚             titel: buch.titel.titel,                                         â”‚  â”‚
â”‚    â”‚             untertitel: buch.titel.untertitel || null                        â”‚  â”‚
â”‚    â”‚         },                                                                   â”‚  â”‚
â”‚    â”‚         // ... weitere optionale Felder                                      â”‚  â”‚
â”‚    â”‚     };                                                                       â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     return executeGraphQL(this.http, CREATE_BUCH_MUTATION, { input });       â”‚  â”‚
â”‚    â”‚ }                                                                            â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. GRAPHQL MUTATION: Create Buch                                                     â”‚
â”‚                                                                                      â”‚
â”‚    graphql-queries.ts:                                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ export const CREATE_BUCH_MUTATION = `                                        â”‚  â”‚
â”‚    â”‚     mutation CreateBuch($input: BuchInput!) {                                â”‚  â”‚
â”‚    â”‚         create(input: $input) {                                              â”‚  â”‚
â”‚    â”‚             id                                                               â”‚  â”‚
â”‚    â”‚         }                                                                    â”‚  â”‚
â”‚    â”‚     }                                                                        â”‚  â”‚
â”‚    â”‚ `;                                                                           â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                      â”‚
â”‚    HTTP Request:                                                                     â”‚
â”‚    POST /graphql                                                                     â”‚
â”‚    Headers:                                                                          â”‚
â”‚        Content-Type: application/json                                                â”‚
â”‚        Authorization: Bearer eyJhbGciOiJSUzI1...  â—„â”€â”€ Token vom AuthInterceptor      â”‚
â”‚    Body: {                                                                           â”‚
â”‚        "query": "mutation CreateBuch($input: BuchInput!) {...}",                     â”‚
â”‚        "variables": { "input": { "isbn": "9783123456789", ... } }                    â”‚
â”‚    }                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼  HTTPS mit JWT Token
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. BACKEND: GraphQL Mutation Resolver                                               â”‚
â”‚                                                                                      â”‚
â”‚    src/buch/resolver/mutation.ts:                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ @Mutation()                                                                  â”‚  â”‚
â”‚    â”‚ @Roles({ roles: ['admin'] })  // â—„â”€â”€ Nur Admins dÃ¼rfen erstellen            â”‚  â”‚
â”‚    â”‚ async create(@Args('input') buchDTO: BuchCreateDTO) {                        â”‚  â”‚
â”‚    â”‚     this.#logger.debug('create: buchDTO=%o', buchDTO);                       â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     const buch = this.#buchDtoToBuch(buchDTO);                               â”‚  â”‚
â”‚    â”‚     const result = await this.#buchWriteService.create(buch);                â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     return { id: result.id };                                                â”‚  â”‚
â”‚    â”‚ }                                                                            â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. KEYCLOAK: JWT Token validieren                                                   â”‚
â”‚                                                                                      â”‚
â”‚    NestJS Keycloak Guard:                                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ 1. Token aus Authorization Header extrahieren                                â”‚  â”‚
â”‚    â”‚ 2. Signatur mit Keycloak Public Key verifizieren                             â”‚  â”‚
â”‚    â”‚ 3. Ablaufzeit (exp) prÃ¼fen                                                   â”‚  â”‚
â”‚    â”‚ 4. Rollen aus Token extrahieren                                              â”‚  â”‚
â”‚    â”‚ 5. PrÃ¼fen: Hat User Rolle "admin"?  âœ“                                        â”‚  â”‚
â”‚    â”‚ 6. Request weiterleiten                                                      â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. BUCH-WRITE-SERVICE: Validierung und Speicherung                                  â”‚
â”‚                                                                                      â”‚
â”‚    src/buch/service/buch-write-service.ts:                                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ async create(buch: Buch) {                                                   â”‚  â”‚
â”‚    â”‚     this.#logger.debug('create: buch=%o', buch);                             â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     // Validierung                                                           â”‚  â”‚
â”‚    â”‚     await this.#validateCreate(buch);                                        â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     // ISBN-Duplikat prÃ¼fen                                                  â”‚  â”‚
â”‚    â”‚     const existing = await this.#prisma.buch.findUnique({                    â”‚  â”‚
â”‚    â”‚         where: { isbn: buch.isbn }                                           â”‚  â”‚
â”‚    â”‚     });                                                                      â”‚  â”‚
â”‚    â”‚     if (existing) {                                                          â”‚  â”‚
â”‚    â”‚         throw new IsbnExistsException(buch.isbn);                            â”‚  â”‚
â”‚    â”‚     }                                                                        â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     // In Datenbank speichern                                                â”‚  â”‚
â”‚    â”‚     const buchDb = await this.#prisma.buch.create({                          â”‚  â”‚
â”‚    â”‚         data: {                                                              â”‚  â”‚
â”‚    â”‚             isbn: buch.isbn,                                                 â”‚  â”‚
â”‚    â”‚             rating: buch.rating,                                             â”‚  â”‚
â”‚    â”‚             art: buch.art,                                                   â”‚  â”‚
â”‚    â”‚             preis: buch.preis,                                               â”‚  â”‚
â”‚    â”‚             rabatt: buch.rabatt,                                             â”‚  â”‚
â”‚    â”‚             lieferbar: buch.lieferbar,                                       â”‚  â”‚
â”‚    â”‚             datum: buch.datum,                                               â”‚  â”‚
â”‚    â”‚             beschreibung: buch.beschreibung,                                 â”‚  â”‚
â”‚    â”‚             autor: buch.autor,                                               â”‚  â”‚
â”‚    â”‚             titel: {                                                         â”‚  â”‚
â”‚    â”‚                 create: { titel: buch.titel.titel, ... }                     â”‚  â”‚
â”‚    â”‚             }                                                                â”‚  â”‚
â”‚    â”‚         }                                                                    â”‚  â”‚
â”‚    â”‚     });                                                                      â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚     return { id: buchDb.id };                                                â”‚  â”‚
â”‚    â”‚ }                                                                            â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 13. PRISMA: INSERT Query                                                             â”‚
â”‚                                                                                      â”‚
â”‚    Generiertes SQL:                                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ INSERT INTO buch.buch (isbn, rating, art, preis, rabatt, lieferbar,          â”‚  â”‚
â”‚    â”‚                        datum, beschreibung, autor, autor_biographie)         â”‚  â”‚
â”‚    â”‚ VALUES ('9783123456789', 4, 'HARDCOVER', 49.99, 0.1, true,                    â”‚  â”‚
â”‚    â”‚         '2025-01-01', 'Ein umfassendes Handbuch...', 'Max Mustermann', ...)  â”‚  â”‚
â”‚    â”‚ RETURNING id;                                                                â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚ INSERT INTO buch.titel (buch_id, titel, untertitel)                          â”‚  â”‚
â”‚    â”‚ VALUES (1159, 'Angular fÃ¼r Profis', 'Ein Praxishandbuch');                   â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 14. RESPONSE: Neue ID zurÃ¼ck                                                         â”‚
â”‚                                                                                      â”‚
â”‚    GraphQL Response:                                                                 â”‚
â”‚    {                                                                                 â”‚
â”‚        "data": {                                                                     â”‚
â”‚            "create": {                                                               â”‚
â”‚                "id": 1159                                                            â”‚
â”‚            }                                                                         â”‚
â”‚        }                                                                             â”‚
â”‚    }                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 15. FRONTEND: Erfolgs-Meldung und Redirect                                           â”‚
â”‚                                                                                      â”‚
â”‚    new.component.ts:                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ this.api.create(payload).subscribe({                                         â”‚  â”‚
â”‚    â”‚     next: () => {                                                            â”‚  â”‚
â”‚    â”‚         this.successMessage = 'Buch erfolgreich angelegt!';                  â”‚  â”‚
â”‚    â”‚         this.isSubmitting = false;                                           â”‚  â”‚
â”‚    â”‚                                                                              â”‚  â”‚
â”‚    â”‚         // Nach 2 Sekunden zur Suche navigieren                              â”‚  â”‚
â”‚    â”‚         setTimeout(() => {                                                   â”‚  â”‚
â”‚    â”‚             this.router.navigate(['/search']);                               â”‚  â”‚
â”‚    â”‚         }, 2000);                                                            â”‚  â”‚
â”‚    â”‚     },                                                                       â”‚  â”‚
â”‚    â”‚     error: (err) => {                                                        â”‚  â”‚
â”‚    â”‚         this.submitError = err.message;                                      â”‚  â”‚
â”‚    â”‚         this.isSubmitting = false;                                           â”‚  â”‚
â”‚    â”‚     }                                                                        â”‚  â”‚
â”‚    â”‚ });                                                                          â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Beteiligte Dateien

### Frontend

| Datei                                  | Rolle                             |
| -------------------------------------- | --------------------------------- |
| `frontend/src/app/new.component.ts`    | Formular-Komponente (1073 Zeilen) |
| `frontend/src/app/buch-api.service.ts` | `create()` Methode                |
| `frontend/src/app/graphql-queries.ts`  | `CREATE_BUCH_MUTATION`            |
| `frontend/src/app/auth.guard.ts`       | Route Protection                  |
| `frontend/src/app/auth.interceptor.ts` | JWT Token hinzufÃ¼gen              |

### Backend

| Datei                                         | Rolle                               |
| --------------------------------------------- | ----------------------------------- |
| `src/buch/resolver/mutation.ts`               | GraphQL Mutation Resolver           |
| `src/buch/service/buch-write-service.ts`      | Create-Logik, Validierung           |
| `src/config/resources/graphql/schema.graphql` | `BuchInput` Type, `create` Mutation |

---

## ğŸ” Wichtige Code-Stellen

### 1. Validierung mit class-validator (Backend)

```typescript
// src/buch/controller/buch-dto.ts
export class BuchCreateDTO {
  @IsISBN(13)
  readonly isbn!: string;

  @IsInt()
  @Min(0)
  @Max(5)
  readonly rating!: number;

  @IsPositive()
  readonly preis!: number;

  @MaxLength(40)
  readonly titel!: TitelDTO;
}
```

### 2. SchlagwÃ¶rter parsen (Frontend)

```typescript
// new.component.ts
parseSchlagwoerter(): string[] | undefined {
    const raw = this.form.value.schlagwoerter;
    if (!raw || raw.trim() === '') return undefined;

    // "Angular, TypeScript, Frontend" â†’ ["Angular", "TypeScript", "Frontend"]
    return raw.split(',').map(s => s.trim()).filter(s => s.length > 0);
}
```

### 3. GraphQL Input Type (Schema)

```graphql
input BuchInput {
  isbn: String!
  rating: Int!
  art: Art
  preis: Float!
  rabatt: Float
  lieferbar: Boolean
  datum: String
  homepage: String
  schlagwoerter: [String]
  beschreibung: String
  autor: String
  autorBiographie: String
  titel: TitelInput!
}

input TitelInput {
  titel: String!
  untertitel: String
}
```

---

## âš ï¸ Fehlerbehandlung

| Fehler                 | Ursache           | Anzeige                 |
| ---------------------- | ----------------- | ----------------------- |
| ISBN existiert bereits | Duplikat in DB    | Popup mit Fehlermeldung |
| Validierungsfehler     | UngÃ¼ltige Daten   | Inline-Fehler am Feld   |
| 401 Unauthorized       | Token abgelaufen  | Redirect zu Login       |
| 403 Forbidden          | Keine Admin-Rolle | Fehlermeldung           |

---

_Weiter zu: [06-buch-loeschen.md](06-buch-loeschen.md)_
